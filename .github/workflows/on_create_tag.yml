name: ðŸš€ Deploy to Production
on:
  push:
    tags:
    # Matches semver format
      - "v[0-9]+.[0-9]+.[0-9]+"

jobs:
  confirm-branch:
    runs-on: ubuntu-latest
    environment: Production
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Fetch all history for all branches and tags

      - name: Validate branch
        id: check_main
        run: |
          TAG_COMMIT=$(git rev-list -n 1 ${{ github.ref }})
          MAIN_COMMIT=$(git rev-list -n 1 origin/main)
          if [ "$TAG_COMMIT" != "$MAIN_COMMIT" ]; then
            echo "Tag is not from the main branch. Exiting."
            exit 1
          fi